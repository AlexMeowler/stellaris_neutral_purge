namespace = neutral_purge

country_event = { #initialize mod event
	id = neutral_purge.1
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		NOT = {
			has_global_flag = neutral_purge_installed
		}
	}
	immediate = {
		log = "Neutral Purge Mod Loaded!"
		set_global_flag = neutral_purge_installed
	}
}

planet_event = { #this is literally copy of "id = action.21" event but removes modifier instead adding it
	id = neutral_purge.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner.capital_scope = {
			has_active_building = building_ministry_of_truth
		}
		exists = fromfrom #crisis.202 can remove the last pop
		FROMFROM = {
			is_robot_pop = no
			is_sapient = yes
			NOT = { has_trait = "trait_hive_mind" }
			OR = {
				NOT = { has_citizenship_type = { country = from type = citizenship_purge } }
				NOT = { has_purge_type = { country = from type = purge_neutering } }
			}
			NOT = { has_purge_type = { country = from type = purge_necrophage } }
		}
		is_controlled_by = FROM
	}

	immediate = {
		#log = "Ministry of Truth working - preventing adjustment of bad opinion"
		every_country = {
			limit = {
				has_communications = FROM
				NOT = { is_country = FROM }
				NOT = { is_same_species = FROMFROM }
				NOT = { has_ai_personality_behaviour = purger }
				OR = {
					is_country_type = default
					has_ai_personality = awakened_fallen_empire_xenophile
				}
				has_intel_level = {
					who = FROM
					category = economy
					level >= 1
				}
			}
			remove_opinion_modifier = { who = FROM modifier = opinion_genocidal }
		}
	}
}

